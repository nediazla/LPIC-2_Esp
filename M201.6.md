# 6. Configuración de red

## 6.1 Configuración básica de red

### Ver interfaces de red
```
ip link
ip addr
ip -c a
```

Levantar / bajar interfaces:
```
ip link set eth0 up
ip link set eth0 down
```

### Configurar una IP estática temporal (no persistente)
```
ip addr add 192.168.1.50/24 dev eth0
ip route add default via 192.168.1.1
```

Eliminar IP temporal:
```
ip addr del 192.168.1.50/24 dev eth0
```

### Ver rutas
```
ip route
```

### Ver tabla ARP
```
ip neigh
```

### Configuración persistente con Netplan (Ubuntu)

Archivos en:
```
/etc/netplan/*.yaml
```

Ejemplo con DHCP:
```
network:
  version: 2
  ethernets:
    ens33:
      dhcp4: true
```

Ejemplo con IP estática:
```
network:
  version: 2
  ethernets:
    ens33:
      addresses: [192.168.1.10/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [1.1.1.1, 8.8.8.8]
```

Aplicar:
```
netplan apply
```

### Configurar DNS temporalmente
```
resolvectl dns eth0 8.8.8.8
resolvectl domain eth0 example.com
```

Ver configuración DNS:
```
resolvectl status
```

---

## 6.2 Configuración avanzada de red

### Alias de interfaces (IP secundaria)
```
ip addr add 10.10.10.5/24 dev eth0
```

### Configurar múltiples rutas
```
ip route add 10.20.0.0/16 via 192.168.1.100
```

Eliminar ruta:
```
ip route del 10.20.0.0/16 via 192.168.1.100
```

### Configurar reglas de routing avanzadas (Policy Routing)

Crear tabla:
```
echo "200 custom" >> /etc/iproute2/rt_tables
```

Agregar reglas:
```
ip rule add from 192.168.50.10 table custom
ip route add default via 192.168.50.1 table custom
```

Ver reglas:
```
ip rule
```

### Configurar enlaces virtuales

Crear interfaz dummy:
```
ip link add dummy0 type dummy
ip addr add 10.0.0.1/32 dev dummy0
ip link set dummy0 up
```

Crear túnel GRE:
```
ip tunnel add tun0 mode gre remote 1.2.3.4 local 5.6.7.8 ttl 255
ip link set tun0 up
```

### VLANs con ip

Instalar herramientas:
```
apt install vlan
modprobe 8021q
```

Crear VLAN 10:
```
ip link add link eth0 name eth0.10 type vlan id 10
ip addr add 192.168.10.1/24 dev eth0.10
ip link set eth0.10 up
```

Ver VLANs:
```
ip -d link show
```

### Bonding (agrupación de interfaces)

Cargar módulo:
```
modprobe bonding
```

Crear bond:
```
ip link add bond0 type bond
ip link set bond0 type bond mode active-backup
ip link set eth0 master bond0
ip link set eth1 master bond0
ip link set bond0 up
```

### Configurar puente (bridge)

Instalar:
```
apt install bridge-utils
```

Crear puente:
```
ip link add name br0 type bridge
ip link set br0 up
ip link set eth0 master br0
```

Ver:
```
bridge link
```

---

## 6.3 Resolviendo problemas de red

### Diagnóstico básico

Ping:
```
ping -c 4 8.8.8.8
```

Traceroute:
```
traceroute 8.8.8.8
traceroute -n 8.8.8.8
```

DNS:
```
dig google.com
nslookup google.com
host google.com
```

Tabla ARP:
```
ip neigh
```

Interfaces:
```
ip link
```

Ver rutas:
```
ip route
```

### Diagnóstico avanzado

Sniffer:
```
tcpdump -i eth0
tcpdump -n host 8.8.8.8
```

Problemas de MTU:
```
ip link set eth0 mtu 1400
ping -M do -s 1472 8.8.8.8
```

Problemas de firewall:
```
iptables -L -n -v
ufw status verbose
```

Ver errores en interfaces:
```
ip -s link
ethtool -S eth0
```

Logs:
```
journalctl -u NetworkManager
journalctl -u systemd-networkd
```

### Problemas comunes y soluciones

1. **Sin IP**
```
dhclient -v eth0
```

2. **Sin DNS**
```
cat /etc/resolv.conf
resolvectl status
```

3. **Gateway incorrecto**
```
ip route add default via <GW>
```

4. **Conflicto de IP**
```
arping 192.168.1.10
```

5. **Conectividad pero sin dominio**
```
dig @8.8.8.8 google.com
```

6. **Red lenta / pérdida de paquetes**
```
mtr google.com
```
