# 3. Compartir ficheros

## 3.1 Configuración del servidor Samba

Samba permite compartir directorios entre sistemas Linux, Windows y macOS usando los protocolos SMB/CIFS.

### Instalar Samba
```
apt update
apt install samba smbclient
```

### Ver versión instalada
```
smbd -V
```

### Archivos importantes

Configuración principal:
```
/etc/samba/smb.conf
```

Logs:
```
/var/log/samba/log.smbd
/var/log/samba/log.nmbd
```

### Crear un recurso compartido básico

Ejemplo de sección en `/etc/samba/smb.conf`:
```
[publico]
    path = /srv/publico
    browseable = yes
    read only = no
    guest ok = yes
```

Crear directorio:
```
mkdir -p /srv/publico
chmod 777 /srv/publico
```

Recargar configuración:
```
systemctl restart smbd
```

### Crear un recurso con autenticación

```
[privado]
    path = /srv/privado
    valid users = usuario1
    browseable = yes
    read only = no
```

Crear usuario del sistema:
```
adduser usuario1
```

Crear usuario Samba:
```
smbpasswd -a usuario1
```

### Ver recursos compartidos en el servidor
```
smbclient -L localhost -U usuario1
```

### Conectarse desde cliente Linux
```
smbclient //servidor/publico
smbclient //192.168.1.10/privado -U usuario1
```

Montar un recurso:
```
mount -t cifs -o username=usuario1 //192.168.1.10/privado /mnt
```

### Ver estado del servicio
```
systemctl status smbd
systemctl restart smbd
systemctl enable smbd
```

### Seguridad básica de Samba
- Restringir acceso por IP:
```
hosts allow = 192.168.1.0/24
hosts deny = 0.0.0.0/0
```

- Deshabilitar SMBv1:
```
server min protocol = SMB2
```

---

## 3.2 Configuración del servidor NFS

NFS permite compartir directorios entre sistemas Linux de forma eficiente.

### Instalar NFS server
```
apt install nfs-kernel-server
```

### Configuración principal
```
/etc/exports
```

### Crear un directorio para exportar
```
mkdir -p /srv/nfs/datos
chown nobody:nogroup /srv/nfs/datos
chmod 755 /srv/nfs/datos
```

### Configurar exportaciones en /etc/exports

Ejemplo:
```
/srv/nfs/datos 192.168.1.0/24(rw,sync,no_subtree_check)
```

Opciones comunes:
- `ro` → solo lectura  
- `rw` → lectura/escritura  
- `sync` → escritura sincronizada (más segura)  
- `async` → más rápida, menos segura  
- `no_root_squash` → root del cliente actúa como root (no recomendado)  
- `root_squash` → root del cliente se convierte en nobody (predeterminado)  

### Aplicar cambios
```
exportfs -ra
systemctl restart nfs-kernel-server
```

### Ver exportaciones activas
```
exportfs -v
showmount -e
```

### Cliente NFS (Linux)

Instalar cliente:
```
apt install nfs-common
```

Montar recurso:
```
mount -t nfs 192.168.1.10:/srv/nfs/datos /mnt
```

Montaje persistente en `/etc/fstab`:
```
192.168.1.10:/srv/nfs/datos /mnt nfs defaults 0 0
```

### Ver información NFS
```
nfsstat -s
nfsstat -c
mount | grep nfs
```

### NFSv4 configuración mínima

En `/etc/exports`:
```
/srv/nfs 192.168.1.0/24(rw,sync,fsid=0)
/srv/nfs/datos 192.168.1.0/24(rw,sync)
```

Cliente:
```
mount -t nfs4 192.168.1.10:/datos /mnt
```

### Seguridad básica para NFS
- Restringir subredes en `/etc/exports`
- Mantener `root_squash` habilitado
- Usar firewall:
```
ufw allow from 192.168.1.0/24 to any port nfs
```

